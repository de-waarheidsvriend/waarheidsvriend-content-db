generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Edition {
  id              Int         @id @default(autoincrement())
  edition_number  Int         @unique
  edition_date    DateTime
  status          String      @default("pending")
  created_at      DateTime    @default(now())
  updated_at      DateTime    @updatedAt
  cover_headlines Json?
  articles        Article[]
  page_images     PageImage[]

  @@map("editions")
}

model Article {
  id              Int             @id @default(autoincrement())
  edition_id      Int
  title           String
  subtitle        String?
  chapeau         String?
  content         String
  excerpt         String?
  category        String?
  page_start      Int?
  page_end        Int?
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  author_bio      String?
  verse_reference String?
  article_authors ArticleAuthor[]
  edition         Edition         @relation(fields: [edition_id], references: [id], onDelete: Cascade)
  images          Image[]

  @@map("articles")
}

model Author {
  id              Int             @id @default(autoincrement())
  name            String          @unique
  photo_url       String?
  created_at      DateTime        @default(now())
  updated_at      DateTime        @updatedAt
  article_authors ArticleAuthor[]

  @@map("authors")
}

model ArticleAuthor {
  article_id Int
  author_id  Int
  article    Article @relation(fields: [article_id], references: [id], onDelete: Cascade)
  author     Author  @relation(fields: [author_id], references: [id], onDelete: Cascade)

  @@id([article_id, author_id])
  @@map("article_authors")
}

model Image {
  id          Int      @id @default(autoincrement())
  article_id  Int
  url         String
  caption     String?
  is_featured Boolean  @default(false)
  sort_order  Int      @default(0)
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  article     Article  @relation(fields: [article_id], references: [id], onDelete: Cascade)

  @@map("images")
}

model PageImage {
  id          Int      @id @default(autoincrement())
  edition_id  Int
  page_number Int
  image_url   String
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
  edition     Edition  @relation(fields: [edition_id], references: [id], onDelete: Cascade)

  @@unique([edition_id, page_number])
  @@map("page_images")
}
